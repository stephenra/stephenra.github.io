



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Personal website of Stephen Ra">
      
      
        <link rel="canonical" href="https://www.stephenra.com/05-07-19-adaptive-sampling/">
      
      
        <meta name="author" content="Stephen Ra">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>On conditioning by adaptive sampling - Stephen Ra</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700|Ubuntu+Mono">
        <style>body,input{font-family:"Lato","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="manifest" href="../manifest.webmanifest">
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="white">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#on-conditioning-by-adaptive-sampling" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.stephenra.com" title="Stephen Ra" class="md-header-nav__button md-logo">
          
            <img src="../img/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Stephen Ra
            </span>
            <span class="md-header-nav__topic">
              On conditioning by adaptive sampling
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/stephenra/stephenra.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    stephenra/stephenra.github.io
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href=".." title="Latest" class="md-tabs__link">
          Latest
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../01-06-20-bbrt/" title="Blog" class="md-tabs__link">
          Blog
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../about/" title="About" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.stephenra.com" title="Stephen Ra" class="md-nav__button md-logo">
      
        <img src="../img/logo.png" width="48" height="48">
      
    </a>
    Stephen Ra
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/stephenra/stephenra.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    stephenra/stephenra.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Latest
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Latest
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="Black box recursive translations for molecular optimization" class="md-nav__link">
      Black box recursive translations for molecular optimization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Blog
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Blog
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      2020
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        2020
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../01-06-20-bbrt/" title="Black box recursive translations for molecular optimization" class="md-nav__link">
      Black box recursive translations for molecular optimization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      2019
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        2019
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        On conditioning by adaptive sampling
      </label>
    
    <a href="./" title="On conditioning by adaptive sampling" class="md-nav__link md-nav__link--active">
      On conditioning by adaptive sampling
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oracles-and-oracle-properties" title="Oracles and oracle properties" class="md-nav__link">
    Oracles and oracle properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conditioning-by-adaptive-sampling" title="Conditioning by adaptive sampling" class="md-nav__link">
    Conditioning by adaptive sampling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#importance-sampling-based-estimation" title="Importance sampling-based estimation" class="md-nav__link">
    Importance sampling-based estimation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/" title=" " class="md-nav__link">
       
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oracles-and-oracle-properties" title="Oracles and oracle properties" class="md-nav__link">
    Oracles and oracle properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conditioning-by-adaptive-sampling" title="Conditioning by adaptive sampling" class="md-nav__link">
    Conditioning by adaptive sampling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#importance-sampling-based-estimation" title="Importance sampling-based estimation" class="md-nav__link">
    Importance sampling-based estimation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/stephenra/stephenra.github.io/edit/master/docs/05-07-19-adaptive-sampling.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="on-conditioning-by-adaptive-sampling">On Conditioning by Adaptive Sampling</h1>
<p>As my very first blog post, I thought I would look at a <a href="https://arxiv.org/abs/1901.10060">great, recent paper</a> by David Brookes, Hahnbeom Park, and Jennifer Listgarten<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>, which extends their <a href="https://arxiv.org/abs/1810.03714">work from last year</a> that posits a framework, <strong>Conditioning by Adaptive Sampling (CbAS)</strong>, for model-based conditional density estimation. Of particular relevance to drug design is the application to protein properties. For example, how do we go about optimizing the design of DNA sequences for protein expression, binding, or for protein sequences that maximize properties like secondary structure or fluorescence?  Traditionally, <em>in vitro</em> methods for protein engineering have been exhaustive usually involving "greedy walks" through protein design space like <a href="https://www.ncbi.nlm.nih.gov/pubmed/1367624">directed evolution (DE)</a>. This paper proposes a more efficient <em>in silico</em> approach. For this particular entry, I'll summarize the key contributions and introduce some of the core concepts. The subsequent post will walk through the <strong>Cross-Entropy Method (CEM)</strong> and their experimental results.</p>
<h2 id="summary">Summary</h2>
<p>The main contributions of this paper are as follows:</p>
<ul>
<li>The authors present a method for tackling design problems in discrete space including the problem of maximizing protein fluorescence using <a href="https://figshare.com/articles/Local_fitness_landscape_of_the_green_fluorescent_protein/3102154">avGFP sequence data</a> from <a href="https://www.nature.com/articles/nature17995">Sarkisyan et al. 2016</a>.</li>
<li>A principled approach for conditional density estimation in the presence of rare events and which doesn't constrain the oracle by requiring differentiability.<ul>
<li>This has the added benefit of recapitulating models in various scientific domains which may not be readily differentiable to begin with</li>
<li>It also allows for a degree of flexibility of validation by using wet-lab experiments as the oracle.</li>
</ul>
</li>
<li>An exact and iterative importance sampling-based estimation method for variance reduction and computationally intractable model densities.</li>
<li>Generalizability of CbAS to specification of property values rather than solely maximization (e.g. a protein fluorescing at a desired wavelength as opposed to being maximally fluorescent).</li>
</ul>
<h2 id="oracles-and-oracle-properties">Oracles and oracle properties</h2>
<p>In order to understand the problem setting in the paper, it's worth briefly reviewing oracles. In statistics, oracle and oracle properties have been extensively used in the context of high-dimensional model estimation and feature selection whereby we have a response vector <script type="math/tex">\boldsymbol{y} = (y_1,...,y_n)^{T}</script> and input vector of linearly independent features  <script type="math/tex">\boldsymbol{x_j} = (x_{1j},...,x_{nj})^{T}</script> with <script type="math/tex">j = 1,..,p</script>. Under the assumption that we have <script type="math/tex">\mathbb{A} = \{ j: \hat{\beta} \neq 0 \}</script>, the true model only depends on a subset <script type="math/tex">X_{S} \subset X</script> of its feature space.</p>
<p>Briefly put, an <strong>oracle property</strong> is a theoretical attribute ascribed to a model if it performs as well as if the correct underlying model were given in advance. More formally and following <a href="https://orfe.princeton.edu/~jqfan/papers/01/penlike.pdf">Fan and Li 2001</a>, <a href="https://projecteuclid.org/euclid.aos/1085408491">Fan and Peng 2004</a>, and <a href="http://pages.cs.wisc.edu/~shao/stat992/zou2006.pdf">Zou 2006</a>, we call a given fitting procedure <script type="math/tex">\delta</script> an <strong>oracle</strong> if <script type="math/tex">\hat{\beta}(\delta)</script>, the coefficient estimator, identifies the right subset model, <script type="math/tex">\{ j: \hat{\beta} \neq 0 \} = \mathbb{A}</script> with some optimal estimation rate:</p>
<script type="math/tex; mode=display">
\sqrt{n} \hat{\beta}(\delta)_{\mathbb{A}} - \beta^*_{\mathbb{A}}) \to \mathcal{N} (0, I^{-1}(\beta^*_\mathbb{A}))
</script>

<p>Thus, the oracle property holds that the asymptotic distribution of the estimator is the same as the asymptotic distribution of the MLE only on the true support. That is, the estimator adapts to knowing the true support without incurring a price. Why is this important? For the authors, they argue that their oracle <script type="math/tex">p(y|\boldsymbol{x})</script> effectively serves as a proxy for expensive and exhaustive laboratory-based property measurements. They also make the assumption that given an input, such as a DNA sequence, the oracle<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup> returns a distribution over the properties of interest. It's worth noting that this is within the context of the generative setting where we model the joint probability distribution <script type="math/tex">p(\boldsymbol{x}, y)</script>. Given the property oracle then, one can subsequently model and empirically sample from the underlying data distribution <script type="math/tex">p_{d}(\boldsymbol{x})</script> with a generative model <script type="math/tex">p(\boldsymbol{x}|\theta)</script> whose prior is conditioned on the desiderata encoded in property values <script type="math/tex">S</script>. The claim here is that this gives a certain degree of flexibility in specifying priors on the design space, unlike <a href="https://pubs.acs.org/doi/full/10.1021/acscentsci.7b00572">Gómez-Bombarelli et al. 2018</a> and <a href="https://arxiv.org/abs/1712.06148">Killoran et al. 2017</a>, which utilize a fixed VAE and GAN respectively.</p>
<p>Lastly, it's worth noting that they do not require their oracle to be differentiable and this additionally circumvents backpropagation through discrete input space.</p>
<h2 id="conditioning-by-adaptive-sampling">Conditioning by adaptive sampling</h2>
<p>The problem setting is as follows: find settings of the discrete random vector <script type="math/tex">\boldsymbol{x} \in \mathbb{N}^{L}</script> (e.g. representative of DNA sequences) that have a high probability of satisfying some property desiderata (e.g. maximal fluoresence of a protein).</p>
<p>The inference problem is expressed as:</p>
<div>
<div class="MathJax_Preview">p(\boldsymbol{x}|S, \theta^{(0)}) = \frac{P(S|\boldsymbol{x})p(\boldsymbol{x}|\theta^{(0)})}{P(S|\theta^{(0)})}</div>
<script type="math/tex; mode=display">p(\boldsymbol{x}|S, \theta^{(0)}) = \frac{P(S|\boldsymbol{x})p(\boldsymbol{x}|\theta^{(0)})}{P(S|\theta^{(0)})}</script>
</div>
<p>where <script type="math/tex">P(S|\theta^{(0)}) = \int_{s} P(S|\boldsymbol{x})p(\boldsymbol{x}|\theta^{(0)}) d\boldsymbol{x}</script>. </p>
<p>Like <a href="https://arxiv.org/abs/1601.00670">variational inference</a>, the marginal probability of CbAS yields no analytic solution as the sum over all possible configurations of the latent structures and its parameters is intractable. Unsurprisingly, inference for CbAS is VI-like in that they minimize the KL divergence between the conditional and the approximating search model, <script type="math/tex">q(\boldsymbol{x}|\phi)</script>:</p>
<div>
<div class="MathJax_Preview">\phi^{*} = \underset{\phi}{\operatorname{argmin}} D_{KL} \big(p(\boldsymbol{x}|S,\theta^{(0)})||q(\boldsymbol{x}|\phi\big)</div>
<script type="math/tex; mode=display">\phi^{*} = \underset{\phi}{\operatorname{argmin}} D_{KL} \big(p(\boldsymbol{x}|S,\theta^{(0)})||q(\boldsymbol{x}|\phi\big)</script>
</div>
<p>This can be re-written in terms of the log expectation of the difference between the search model distribution and the target conditional distribution, similar to how the <strong>Evidence Lower Bound (ELBO)</strong> can be derived:</p>
<div>
<div class="MathJax_Preview">\underset{\phi}{\operatorname{argmin}}\mathbb{E}_{p(\boldsymbol{x}|S,\theta^{(0)})}[\log p(\boldsymbol{x}|S,\theta^{(0)}) - \log q(\boldsymbol{x}|\phi)]</div>
<script type="math/tex; mode=display">\underset{\phi}{\operatorname{argmin}}\mathbb{E}_{p(\boldsymbol{x}|S,\theta^{(0)})}[\log p(\boldsymbol{x}|S,\theta^{(0)}) - \log q(\boldsymbol{x}|\phi)]</script>
</div>
<p>Thus, the second expectation can be expressed as the entropy of the target conditional distribution <script type="math/tex">H_{0} \equiv -\mathbb{E}_{p(\boldsymbol{x}|S,\theta^{(0)})}[\log p(\boldsymbol{x}|S,\theta^{(0)})]</script>:</p>
<script type="math/tex; mode=display">
\begin{align}
  & = \underset{\phi}{\operatorname{argmin}}-\mathbb{E}_{p(\boldsymbol{x}|S,\theta^{(0)})}[\log q(\boldsymbol{x}|\phi)] - H_{0}
  \newline
  & = \underset{\phi}{\operatorname{argmax}} \frac{1}{P(S|\theta^{(0)})} \mathbb{E}_{(p(\boldsymbol{x}|S,\theta^{(0)})}[P(S|\boldsymbol{x}) \log q(\boldsymbol{x}|\phi)]
  \newline
  & = \underset{\phi}{\operatorname{argmax}}\mathbb{E}_{p(\boldsymbol{x}|\theta^{(0)})}[P(S|\boldsymbol{x}) \log q(\boldsymbol{x}|\phi)] & \scriptstyle{H_{0}, P(S|\theta^{(0)}) \text{ dropped}} \\[2mm]
  \end{align}
</script>

<p>The authors also note that the difficulty of estimating the normalizing constant is compounded by the fact that <script type="math/tex">S</script> (and by definition, <script type="math/tex">P(S|\boldsymbol{x})</script> ) is "exceedingly rare". This translates to difficulties in optimization: any gradient-based reparameterization which yields differentiable Monte Carlo (MC) estimates of our expectation (i.e. the 'reparameterization trick' from <a href="https://www.ics.uci.edu/~welling/publications/papers/AEVB_ICLR14.pdf">Kingma and Welling 2014</a>) would require a non-trivial number of samples to be accurate and be very challenging for distributions over discrete state spaces. To put it another way, any naive MC estimation would require an intensive simulation effort, inversely proportional to the magnitude of <script type="math/tex">P(S|\boldsymbol{x})</script>.</p>
<h2 id="importance-sampling-based-estimation">Importance sampling-based estimation</h2>
<p>I'm not going to review importance sampling here<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup>. Suffice to say that the basic idea is that we can estimate the expectation of a random variable under one distribution <script type="math/tex">p(\boldsymbol{x})</script> from samples of an alternative distribution <script type="math/tex">r(\boldsymbol{x})</script> and that our importance sampling distribution <script type="math/tex">r(\boldsymbol{x})</script> can be used to mitigate the problem of high variance and an exceedingly small expectation <script type="math/tex">\mathbb{E}_{r^{(t)}(\boldsymbol{x})} \big[P(S^{(t)}|\boldsymbol{x}\big]</script>. This approach is not without drawbacks however, and perturbations in weight space can have deleterious effects on the estimator.</p>
<p>Thus, the objective can be rewritten as:</p>
<script type="math/tex; mode=display">
\begin{align}
& = \mathbb{E}_{r(\boldsymbol{x})}\Bigg[\frac{p(\boldsymbol{x}|\theta^{(0)})}{r(x)}[P(S|\boldsymbol{x}) \log q(\boldsymbol{x}|\phi)]\Bigg]
\newline
& = \mathbb{E}_{q(\boldsymbol{x}|\phi^{(t)})}\Bigg[\frac{p(\boldsymbol{x}|\theta^{(0)})}{q(\boldsymbol{x}|\phi^{(t)})}[P(S^{(t)}|\boldsymbol{x}) \log q(\boldsymbol{x}|\phi)]\Bigg]
\end{align}
</script>

<p>where <script type="math/tex">p(\boldsymbol{x}|\theta^{(0)})</script> is our target density, <script type="math/tex">q(\boldsymbol{x}|\phi^{(t)})</script> is our proposed density and the ratio of the two:</p>
<div>
<div class="MathJax_Preview">\frac{p(\boldsymbol{x}|\theta^{(0)})}{q(\boldsymbol{x}|\phi^{(t)})}</div>
<script type="math/tex; mode=display">\frac{p(\boldsymbol{x}|\theta^{(0)})}{q(\boldsymbol{x}|\phi^{(t)})}</script>
</div>
<p>is the eponymous <strong>importance weight</strong>. Now that we have this objective and given samples <script type="math/tex">\{x^{(i)} \}^{(n)}_{i}</script> from <script type="math/tex">q(\boldsymbol{x}|\phi^{(t)})</script>, we can construct MC estimates:</p>
<script type="math/tex; mode=display">
\begin{align}
& \phi^{(t+1)} = \underset{\phi}{\operatorname{argmin}}\sum_{i=1}^{M} \frac{p(\boldsymbol{x}_{i}^{(t)}|\theta^{(0)})}{q(\boldsymbol{x}_{i}^{(t)}|\phi^{(t)})} P(S^{(t)}|\boldsymbol{x}_{i}^{(t)}) \log q(\boldsymbol{x}_{i}^{(t)}|\phi)]
\end{align}
</script>

<p>I think this is a particularly clever reformulation because it does not constrain the authors' choice of search model distribution to a single model class. For example, for cases where marginalization over latent space is intractable and the CbAS objective cannot be solved exactly (i.e. where a vanilla VAE is used), approximate inference approaches can be used instead to extend the model class, something I alluded to earlier. I'm not going to go through the <a href="https://arxiv.org/pdf/1901.10060.pdf">explicit derivation of the ELBO-like objective</a> but it's worth noting that in many cases where the CbAS update can be solved, this product: </p>
<script type="math/tex; mode=display">
\begin{align}
\require{color}
& \phi^{(t+1)} = \underset{\phi}{\operatorname{argmin}}\sum_{i=1}^{M} \colorbox{GreenYellow}{$\frac{p(\boldsymbol{x}_{i}^{(t)}|\theta^{(0)})}{q(\boldsymbol{x}_{i}^{(t)}|\phi^{(t)})} P(S^{(t)}|\boldsymbol{x}_{i}^{(t)})$} \log q(\boldsymbol{x}_{i}^{(t)}|\phi)]
\end{align}
</script>

<p>translates to an importance weighting of the probability of a series of property value sets <script type="math/tex">S^{(t)}</script> conditioned on each data point, <script type="math/tex">\boldsymbol{x}_{i}^{(t)}</script> (i.e. the weight of each data point). This is similar to a weighted maximum likelihood objective and can therefore be optimized using any number of standard approaches for training generative models.</p>
<p>More to come on the experimental results in the next entry...</p>
<!-- Bears similarity with the **Cross-Entropy Method (CEM)** of [Rubinstein 1999](https://link.springer.com/article/10.1023/A:1010091220143).

![alt-text-1](img/adaptive-sampling-figure2b.png "figure2b") -->

<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>A good entry point to Listgarten's earlier work is her interview on <a href="https://art19.com/shows/talking-machines/episodes/632ffc91-f94b-4997-9b62-8d2c03840c21">Talking Machines</a>, where she discusses her work at MSR New England on predicting off-target effects for CRISPR guide design.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Additional assumptions are that the oracle is well-behaved and noise-free&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>For this, I recommend <a href="https://statweb.stanford.edu/~owen/mc/Ch-var-is.pdf">this chapter</a> from Art Owen's book, "Monte Carlo theory, methods and examples".&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../01-06-20-bbrt/" title="Black box recursive translations for molecular optimization" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Black box recursive translations for molecular optimization
              </span>
            </div>
          </a>
        
        
          <a href="../about/" title=" " class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                 
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Stephen Ra
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="mailto:stephen.ra@pfizer.com" class="md-footer-social__link fa fa-envelope-o"></a>
    
      <a href="https://github.com/stephenra" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/stephenrra" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../js/extra.js"></script>
      
        <script src="../js/mathjax-config.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>